# 혼자 공부하는 컴퓨터 구조+운영체제

## 운영체제 시작하기

### 운영체제를 알아야 하는 이유

> 요약: 하드웨어를 조작하는 운영체제를 이해하면 하드웨어와 프로그램을 더 깊이 이해하게 되고 문제 해결의 실마리를 찾을 수 있게 된다.

운영체제는 실행할 프로그램에 자원을 할당하고, 프로그램이 문제 없이 실행되도록 돕는 **프로그램**이다.
결국 운영체제도 프로그램이기에, 운영체제는 커널 영역이라는 메모리 영역에 적재된다(반대로 응용 프로그램이 적재되는 메모리 영역을 사용자 영역이라고 한다).

운영체제는 컴퓨터 하드웨어와 응용 프로그램 사이의 인터페이스 역할을 한다. 따라서 하드웨어를 조작하는 운영체제를 이해하면 하드웨어와 응용 프로그램을 더 깊이 이해하게 되고 문제 해결의 실마리를 찾을 수 있게 된다.

예시: 운영체제가 프로세스와 스레드를 어떻게 관리하는지 이해해야 멀티 프로세스/스레드 프로그래밍을 할 수 있다.

### 운영체제의 큰 그림

> 요약: 운영체제의 핵심은 커널이다. 응용 프로그램은 직접 CPU나 메모리 같은 리소스에 접근할 수 없다. 시스템콜을 호출하여 커널모드로 전환해야 한다.

운영체제의 핵심은 커널이다. 커널은 운영체제의 핵심 기능을 담당하는데 대표적으로 자원 접근 및 할당, 프로세스 관리, 파일 시스템 관리 등을 처리한다.

이중모드는 CPU가 ㅁ여렁어를 실행하는 모드를 커널 모드와 사용자 모드로 구분하는 방식이다.

응용 프로그램은 직접 컴퓨터 자원에 접근할 수 없다(위험함). 따라서 응용 프로그램은 운영체제를 통해서 접근해야 하는데 시스템콜을 통해 커널 모드로 전환하고 응용체제 코드 사용

## 프로세스와 스레드

### 프로세스 개요

> 요약

프로세스는 메모리 위에 올라온 실행 중인 프로그램이다. 프로세스는 foreground process와 background process로 구분된다.

프로세스는 실행되기 위해 CPU가 필요하지만 CPU는 한정적이다. 따라서 프로세스는 한정된 시간동안 CPU를 이용하고 타이머 인터럽트 발생 시 차례를 양보한다.

운영체제는 프로세스를 관리하기 위해 프로세스의 메타 데이터가 저장된 자료구조, PCB(Process Control Block)를 커널 영역에 저장한다.

다음은 PCB에 저장된 데이터들이다.

-   PID: 프로세스 식별을 위해 부여된 고유한 번호
-   레지스터 값:
-   프로세스 상태:
-   메모리 정보:
-   사용할 파일과 입출력 장치 정보:

문맥 교환에 관련된 내용 보충할 것

메모리의 구조는 코드 영역, 데이터 영역, 힙 영역, 스택 영역으로 나뉜다.
운영체제는 프로세스를 관리하는 역할을 하는데 관리를 위해 프로세스의 메타데이터가 저장된 PCB(Process Control Block)을 커널 영역에 저장한다.

### 프로세스 상태와 계층 구조

> 요약

운영체제는 프로세스의 상태를 PCB에 기록한다.

다음은 프로세스의 상태이다.

-   생성(New): 프로세스가 막 생성되어 PCB를 할당 받은 상태
-   준비(Ready): 언제든 CPU를 할당 받아 실행 가능한 상태
-   실행(Running): CPU를 할당 받아 실행 중인 상태
-   대기(Blocked): 프로세스가 특정 이벤트(예: I/O 작업 완료)를 기다리는 상태. 이 상태에서 프로세스는 CPU를 사용할 수 없다.
-   종료(Terminated): 프로세스가 종료된 상태. 이후 프로세스와 PCB를 메모리에서 폐기한다.

프로세스는 다른 프로세스를 생성할 수 있는데 생성된 프로세스를 자식 프로세스, 생성한 프로세스를 부모 프로세스라고 한다.
프로세스를 생성할 때는 `fork()` 함수를 호출하여 자신과 같은 프로세스를 메모리에 복사하고, `exec()` 함수를 호출하여 새로 생성할 프로세스로 덮어쓴다.
따라서 프로세스는 계층 구조를 갖는다.

### 스레드

> 요약

스레드는 프로세스 내의 실행흐름이다.
초기에는 여러 작업을 할 때 멀티 프로세스를 사용했지만 자원을 공유하지 않기 때문에 문맥 교환(context switch) 오버 헤드 발생
스레드는 프로세스 내부에 존재하기 떄문에 자원을 공유한다.

## CPU 스케쥴링

### CPU 스케쥴링 개요

> 요약

CPU 스케쥴링이란 프로세스와 스레드에게 CPU 자원을 할당하는 것.

### CPU 스케쥴링 알고리즘

> 요약

CPU 스케쥴링 알고리즘 7개 있다.

## 프로세스 동기화

### 동기화란

> 요약

멀티 프로세스, 멀티 스레드로 작업을 하다보면 각 프로세스와 스레드가 서로 다른 공유 자원의 값을 갖게 될 수 있다.
모든 프로세스와 스레드가 같은 자원 값을 유지하도록 하는 것을 동기화라고 한다.

동기화를 하기 위해서는 코드 시행 순서를 컨트롤 하는 방법과, 한 자원에 대해서 동시에 여러 프로세스가 접근하지 못하게 하는 방법이 있다.

### 공유 자원과 임계 구역

-   공유 자원(Shared Resource): 여러 프로세스와 스레드가 공유하는 자원으로 전역 변수, 입출력 장치, 보조기억장치 등이 될 수 있다.
-   임계 구역(Critical Section): 여러 프로세스와 스레드가 동시에 접근하면 문제가 발생할 수 있는 코드 영역으로 주로 공유 자원에 접근하거나 수정하는 코드를 포함한다.
-   레이스 컨디션(Race Condition): 여러 프로세스나 스레드가 임계 구역에 동시에 접근하여 자원의 일관성이 깨진 상태

### 동기화 기법

#### 뮤텍스 락

뮤텍스 락은 여러 프로세스가 동시에 한 자원에 접근하지 못하도록 하는 동기화 도구이다.
뮤택스 락은 lock 상태를 표현하는 변수와 락을 거는 `acquire()` 함수와 락을 해제하는 `release()` 함수로 구성된다.
어떤 프로세스가 임계 지점에 들어가기전에 `acquire()` 함수를 호출하여 락을 걸고 임계 지점에서 작업을 다 처리한 후에 `release()` 함수를 호출하여 다른 프로세스가 임계 구역에 접근할 있도록 한다.

```py
lock = True

def acquire():
    while lock:
        pass
    lock = True


def release():
    lock = False

acquire()
# 임계 구역
release()
```

#### 세마포어(semaphore)

세마포어는 신호라는 뜻으로 임계 구역 진입전에 wait 신호가 있으면 대기하고 signal 신호가 있으면 임계 구역에 진입한다.

```py
S = 2
def wait():
    S -= 1
    while S < 0:
        pass


def signal():
    S += 1
```

#### 모니터

세마포어를 사용할 경우 wait 함수와 signal 함수 호출 실수가 있을 수 있다. 모니터는 이런 점을 보완한 동기화 도구이다.
